<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>1</storyId>
    <title>Configure Redis + BullMQ plumbing (local + env)</title>
    <status>drafted</status>
    <generatedAt>2026-03-01</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/3-1-configure-redis-bullmq-plumbing-local-env.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>queue infrastructure wired for local development</iWant>
    <soThat>async ingestion/indexing can run via a worker</soThat>
    <tasks>
      <task id="T1">Redis connection configuration via env (`REDIS_URL`) (AC: 1)</task>
      <task id="T2">BullMQ queues + noop processor (`src/jobs/queues.ts`, `src/jobs/worker.ts`) (AC: 1)</task>
      <task id="T3">Route/service to enqueue a test job (AC: 1)</task>
      <task id="T4">Retries + backoff config (AC: 2)</task>
      <task id="T5">Status endpoint to query job state (AC: 3)</task>
      <task id="T6">Tests using stubs/mocks (AC: 1-3)</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1">App can enqueue a test job and worker completes it.</ac>
    <ac id="2">Failures retried with backoff.</ac>
    <ac id="3">Job status queryable (queued/running/succeeded/failed).</ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/epics.md" title="Epics" section="Epic 3 / Story 3.1" snippet="Wire Redis + BullMQ plumbing; noop processor; job status queryable." />
      <doc path="docs/architecture.md" title="Architecture" section="Decision Summary" snippet="Background jobs: BullMQ + Redis; worker service on Cloud Run." />
    </docs>
    <code>
      <file path=".env.example" kind="config" symbol="REDIS_URL" lines="7-10" reason="Redis URL configuration boundary." />
      <file path="scripts/worker.mjs" kind="runtime" symbol="placeholder worker" lines="1-30" reason="Worker entrypoint will be updated to run BullMQ worker while still serving health." />
    </code>
  </artifacts>
</story-context>

